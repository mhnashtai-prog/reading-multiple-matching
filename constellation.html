<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTUNITY - Reading Comprehension Part 6</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e3a5f">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-blue: #1e3a5f;
            --secondary-teal: #26a69a;
            --accent-gold: #ffd54f;
            --success-green: #66bb6a;
            --error-red: #ef5350;
            --background-dark: #0a1628;
            --text-light: #ffffff;
            --card-glass: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--background-dark) 0%, var(--primary-blue) 100%);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
        }
        
        /* Header Navigation */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--card-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
        }
        
        .brand-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: -5px;
        }
        
        .exam-info {
            font-size: 0.8rem;
            color: var(--text-light);
            opacity: 0.8;
        }
        
        .author-credit {
            position: absolute;
            top: 5px;
            right: 30px;
            font-size: 0.7rem;
            color: var(--text-light);
            opacity: 0.6;
        }
        
        .nav-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .nav-btn {
            background: var(--card-glass);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .nav-btn:hover {
            background: var(--secondary-teal);
            transform: translateY(-2px);
        }

        .test-selector {
            background: var(--accent-gold);
            color: var(--primary-blue);
            font-weight: 600;
            min-width: 180px;
            font-size: 0.8rem;
        }
        
        /* Main Container - Mobile First */
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
            gap: 20px;
        }
        
        /* Passage Area */
        .passage-container {
            background: var(--card-glass);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            border: 1px solid var(--card-border);
            padding: 20px;
            position: relative;
        }
        
        .constellation-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20px 30px, var(--accent-gold), transparent),
                radial-gradient(2px 2px at 40px 70px, var(--secondary-teal), transparent),
                radial-gradient(1px 1px at 90px 40px, var(--text-light), transparent);
            background-size: 150px 80px;
            opacity: 0.2;
            animation: twinkle 4s ease-in-out infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.2; }
            100% { opacity: 0.4; }
        }
        
        .passage-content {
            position: relative;
            z-index: 2;
        }
        
        .passage-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--accent-gold);
            text-align: center;
        }
        
        .passage-text {
            font-size: 1rem;
            line-height: 1.7;
            white-space: pre-wrap;
        }
        
        /* Interactive Gaps */
        .gap {
            display: inline-block;
            min-width: 50px;
            height: 30px;
            border: 2px solid var(--secondary-teal);
            border-radius: 8px;
            background: rgba(38, 166, 154, 0.15);
            margin: 0 3px;
            padding: 2px 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
            line-height: 26px;
        }
        
        .gap:hover {
            border-color: var(--accent-gold);
            background: rgba(255, 213, 79, 0.3);
            transform: scale(1.1);
        }
        
        .gap.selected {
            border-color: var(--accent-gold);
            background: rgba(255, 213, 79, 0.4);
            box-shadow: 0 0 15px rgba(255, 213, 79, 0.5);
        }
        
        .gap.filled {
            border-color: var(--success-green);
            background: rgba(102, 187, 106, 0.3);
            color: var(--success-green);
        }
        
        .gap.error {
            border-color: var(--error-red);
            background: rgba(239, 83, 80, 0.3);
            color: var(--error-red);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }
        
        /* Progress and Controls */
        .controls-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .progress-card {
            background: var(--card-glass);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            border: 1px solid var(--card-border);
            padding: 15px;
            text-align: center;
        }
        
        .progress-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--accent-gold);
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-teal), var(--accent-gold));
            border-radius: 3px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .progress-text {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .controls-card {
            background: var(--card-glass);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            border: 1px solid var(--card-border);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn {
            background: var(--secondary-teal);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover:not(:disabled) {
            background: var(--accent-gold);
            transform: translateY(-2px);
        }
        
        .btn.primary {
            background: var(--accent-gold);
        }
        
        .btn:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
            transform: none;
        }
        
        /* Modal Selection Interface */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--primary-blue);
            border: 2px solid var(--card-border);
            border-radius: 20px;
            padding: 25px;
            max-width: 90%;
            max-height: 85%;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .options-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            background: var(--card-glass);
            border: 2px solid var(--card-border);
            color: var(--text-light);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }
        
        .option-btn:hover {
            border-color: var(--secondary-teal);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .option-btn.used {
            opacity: 0.5;
            border-color: var(--success-green);
            cursor: not-allowed;
        }
        
        .option-letter {
            display: inline-block;
            width: 28px;
            height: 28px;
            background: var(--secondary-teal);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-weight: 600;
            margin-right: 12px;
            font-size: 0.9rem;
        }
        
        .option-btn.used .option-letter {
            background: var(--success-green);
        }
        
        .option-text {
            line-height: 1.5;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .modal-btn {
            background: var(--card-glass);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn:hover {
            background: var(--secondary-teal);
        }
        
        /* Desktop Layout */
        @media (min-width: 768px) {
            .container {
                flex-direction: row;
                padding: 20px;
            }
            
            .passage-container {
                flex: 2;
                padding: 30px;
            }
            
            .controls-section {
                flex: 1;
                grid-template-columns: 1fr;
                gap: 20px;
                margin-top: 0;
            }
            
            .modal-content {
                max-width: 600px;
            }
            
            .header {
                padding: 20px 30px;
            }
            
            .brand-title {
                font-size: 1.8rem;
            }
            
            .exam-info {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="author-credit">By Majid Nashai</div>
        <div class="logo-section">
            <div class="brand-title">INTUNITY</div>
            <div class="exam-info">Reading Comprehension • Part 6</div>
        </div>
        <nav class="nav-controls">
            <a href="index.html" class="nav-btn">
                <i class="fas fa-home"></i> Home
            </a>
            <select class="nav-btn test-selector" id="test-selector">
                <option value="1">Test 1: Blind Runner</option>
                <option value="2">Test 2: Hollywood Sign</option>
                <option value="3">Test 3: Music & Running</option>
                <option value="4">Test 4: Grand Prix Driver</option>
            </select>
            <button class="nav-btn" id="hint-btn">
                <i class="fas fa-lightbulb"></i>
            </button>
            <button class="nav-btn" id="reset-btn">
                <i class="fas fa-refresh"></i>
            </button>
        </nav>
    </header>

    <div class="container">
        <!-- Passage Area -->
        <div class="passage-container">
            <div class="constellation-bg"></div>
            <div class="passage-content">
                <h2 class="passage-title" id="passage-title">Loading Test...</h2>
                <div class="passage-text" id="passage-text">
                    <p>Initializing constellation interface...</p>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <!-- Progress Card -->
            <div class="progress-card">
                <h3 class="progress-title">Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p class="progress-text">
                    <span id="completed-count">0</span> of <span id="total-gaps">6</span> completed
                </p>
            </div>

            <!-- Controls -->
            <div class="controls-card">
                <button class="btn" id="check-btn">
                    <i class="fas fa-check"></i> Check Answers
                </button>
                <button class="btn primary" id="next-btn">
                    <i class="fas fa-arrow-right"></i> Next Test
                </button>
            </div>
        </div>
    </div>

    <!-- Selection Modal -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title">Select option for Gap [1]</h3>
            <div class="options-grid" id="options-grid">
                <!-- Options will be populated here -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn" id="clear-gap-btn">
                    <i class="fas fa-eraser"></i> Clear Gap
                </button>
                <button class="modal-btn" id="close-modal-btn">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTest = null;
        let currentTestId = 1;
        let userAnswers = new Array(6).fill(null);
        let usedOptions = new Set();
        let currentGapIndex = -1;

        // Embedded test data - no external files needed
        const TESTS = {
            1: {
                id: 1,
                title: "Breaking Barriers: The Blind Runner's Journey",
                passage: `Running marathons, a race of 42 km, has become increasingly popular. This distance poses extreme physical and mental challenges for anyone, but for those who have been blind since birth or have lost their sight later in life, the challenges are even greater. <span class='gap' data-gap='1'>[1]</span>

For the blind runner Simon, now 29, he has been overcoming this disability to compete in marathons, ultra-marathons and other races with runners who are not as his guides, and also, rather uniquely, by teaching himself to run solo, one on the streets. <span class='gap' data-gap='2'>[2]</span> 'I'll have right-angled cornering obstacles,' he thought. 'If I have significant running obstacles,' he explains. <span class='gap' data-gap='3'>[3]</span> Then he got bored again and wanted to try running solo again.

Weeks of gradual exploration followed, walking a route over and over again. 'I break down sections into manageable parts with a heavy main road. He would measure the distance to the next obstacle, identify where each turn was located, stop off the area using a smartphone app. <span class='gap' data-gap='4'>[4]</span> This information could then be transferred to a smartphone, enabling his phone to call out directions into his earphones.

Now Simon knows precisely when all steps on the roads. Simon has been able gradually to increase the pace and can now run from six to thirty miles and run for 60 miles. <span class='gap' data-gap='5'>[5]</span> Now it has evolved quietly and steadily. <span class='gap' data-gap='6'>[6]</span>

But for Simon the real thrill and motivation for training come from simply being able to compete successfully in races. 'I don't think this but I'm blind,' he says. 'But at the same time I would rather not have people really disappointed and not belong into a special group. Being visually impaired doesn't mean you can't run.'`,
                options: [
                    "A. These provide the familiarity and consistency essential for the blind runner.",
                    "B. Their support gave him extra confidence regarding his changing surroundings.", 
                    "C. Simon believes the feelings of liberation and independence he gets from running solo far outweigh any anxiety over such dangers.",
                    "D. He began by training on football pitches behind his house, running between the goalposts.",
                    "E. It gives him a great opportunity to run with everyone.",
                    "F. That's not to say the learning curve has been without incident.",
                    "G. As a result of this slow experimentation, he was able to memorise a set five-kilometre course."
                ],
                answers: [3, 1, 6, 7, 2, 4]
            },
            2: {
                id: 2,
                title: "Icon of Dreams: The Hollywood Sign Story",
                passage: `I am responsible for maintaining and protecting the sign. <span class='gap' data-gap='1'>[1]</span> When I first arrived in 1996, security was pretty low-tech – we put up a fence around the sign to stop trespassers messing with it. But people just jumped over the fence. The back of the sign was black with graffiti – there was barbed wire across it, but they still got through. So I decided to improve the effectiveness of the security.

Now we have motion-detectors and cameras. Everything goes via the internet to a dedicated surveillance team watching various structures around the city. <span class='gap' data-gap='2'>[2]</span> But you can get a closer look at one of my regular tours.

It's also important to protect the sign's image as it's used in loads of adverts and news pieces. There's a simple rule about how the sign can be used. <span class='gap' data-gap='3'>[3]</span> However, it mostly comes down to the look. To take a different example, if you used 'Hollywood' in the name of your bakery, it would depend what the word looked like, whether it was just spelled out or whether the image of the sign itself was used.

People call up with the most ridiculous ideas. They want to light the sign, paint it pink, or cover it in something to promote their product. You'll get a really enthusiastic marketing manager on the phone, terribly excited because they think they're the first person to think of this or that idea. <span class='gap' data-gap='4'>[4]</span> That's because we don't like to change the image and we hope it will have the same significance for generations to come.

In the past, TV started to become popular and some Hollywood film studios closed, but then TV companies moved in and grew them over. At this point, the city of Los Angeles decided to renovate the sign. The letters spelling 'land' were removed and it was repaired. Modern Hollywood was born. The letters in the sign weren't straight and still aren't. <span class='gap' data-gap='5'>[5]</span> They follow the shape of Mount Lee as part of their base.

<span class='gap' data-gap='6'>[6]</span> I can't say they stopped by to visit and ran round. But what did other visitors make of the actual sign?`,
                options: [
                    "A. Even so, people still try to climb over the barrier, mostly innocent tourists surprised that you can't walk right up to the sign.",
                    "B. They mostly get turned down.",
                    "C. If one of them ever fell down I would have to put it back up at exactly the same angle.",
                    "D. We used to have real problems.",
                    "E. Things have changed a lot since then.",
                    "F. It's still there, of course, and is a symbol of the entertainment world.",
                    "G. If the purpose is commercial – to promote something – payment has to be made."
                ],
                answers: [4, 1, 7, 2, 3, 5]
            },
            3: {
                id: 3,
                title: "Beat the Clock: How Music Boosts Athletic Performance", 
                passage: `An expert on the effects of music on exercise, Dr Costas Karageorghis, claims that listening to music while running can boost performance by up to 15%. <span class='gap' data-gap='1'>[1]</span> With the right beats, you find yourself running to the beat, which helps. It also brings out people to cheer you on. Rosie Bradford was also a convert: 'As we ran past one band and they started playing Those Boots Rise Music for Digging, everybody suddenly went faster.'

The only person I found who was less than happy with the music was Luis Lloyd. 'If there wasn't enough of it, and I found it wasn't loud enough to film with an MP3 player,' she said. <span class='gap' data-gap='2'>[2]</span> Karageorghis is not surprised when I tell him. There are many advantages to listening to your own playlist, he says. <span class='gap' data-gap='3'>[3]</span>

As I hung on to start my running, 4,000 other runners were preparing to test this theory. I was starting I sang in my head with the beat, making it easy to keep in rhythm. Usually when they are preparing, and be focus on exactly when they are running and prepare where is possible to be distracted from what is going on around them. <span class='gap' data-gap='4'>[4]</span> Apart from the song at the start, which I barely remember, I mostly remembered The Best Just As Good music during the course: but it was so loud it was embarrassing.

Later I was told me there was a direct correlation between the quality of the music on the course and how fast I ran. <span class='gap' data-gap='5'>[5]</span> That quality, of course, is subjective. I remember the best-planned section as I ran past one band playing King of Leon's Your Hands. <span class='gap' data-gap='6'>[6]</span>

Of course, the music wasn't the only thing there to help. It was also to help the beat tempo, but to provide a sense of occasion, drive out the pace and present it as a certain atmosphere.`,
                options: [
                    "A. I need my music all the time.",
                    "B. I think they know why I found the music here so distracting.", 
                    "C. I enjoyed that for a few moments, but both of them came and went in a flash.",
                    "D. Along with some spring sunshine, it certainly achieved that.",
                    "E. Someone else, though, may have found it uplifting.",
                    "F. I was, in fact, taking my running pretty seriously at that time.",
                    "G. The music here has been great for my performance."
                ],
                answers: [5, 2, 7, 1, 6, 3]
            },
            4: {
                id: 4,
                title: "Life in the Fast Lane: A Formula One Champion's Story",
                passage: `I'm a great believer in success, in achieving whatever goal you set on a particular day, so whether I was practising on the track or swimming in the pool, I've always put my heart and soul into it.

When I was learning my trade, racing go-karts as a teenager, I went after my helmet and race number like a maniac, and soon discovered everything had to be perfect. It was all about preparation. At 16 I graduated to Formula Ford, and I'd even get the car up in the garage and polish the underside until it was gleaming. <span class='gap' data-gap='1'>[1]</span> I made that point, jokingly, that if I ever rolled over in a race, I so wanted the world's cleanest underside in history.

It may be that my quiet achievement of Formula One fuelled this obsession with neatness and cleanliness. <span class='gap' data-gap='2'>[2]</span> Racing is all about getting the extra tenth of a second. If you walk around a team factory it looks like a science laboratory. A Formula One factory couldn't be further from that. It's like something from another planet.

Everything to aircraft standard and quality. And so it should be. If some single-out potential or some racks doesn't do people slouching around, that doesn't make a great impression. <span class='gap' data-gap='3'>[3]</span> It took you walk in and everyone's working hard and there's not a speck of dust anywhere, that's another matter.

Polishing my helmet was a specific ritual I had. The race helmet is an important and prized possession. When you're starting out, you only have one helmet for several years and it can be a pricey piece of kit. <span class='gap' data-gap='4'>[4]</span> Once you're getting through probably a dozen or more expensive helmets each year. Normally I'd never have dreamed of wearing someone else's, but I still race 300 at the Monaco Grand Prix that year. I couldn't see properly.

It may help that he'd second in the Brazilian Grand Prix with that same helmet and finished second in a different race. Four years later, Nelson said he wanted to swap another helmet with me. <span class='gap' data-gap='5'>[5]</span> There must be something in it. So I gave him a helmet and he gave me a signed one.

Helmets are treasured and it's quite rare for me to give race ones to anyone. <span class='gap' data-gap='6'>[6]</span> I only do it if I liked someone recently, although we've known each other for many years.`,
                options: [
                    "A. I certainly took good care of mine as a result.",
                    "B. You take for granted those you're closest to, and you make an effort with people you hardly know.",
                    "C. But it was only natural for me to be so particular about cleanliness before racing.",
                    "D. Think of a motor mechanic, and you think of oil and dirt, filthy overalls, grubby fingers.",
                    "E. Some people said this was ridiculous because it wasn't as if anyone was ever going to see it.",
                    "F. Perhaps I should be doing it as well.",
                    "G. That's why all the teams try and compete hard with each other on presentation."
                ],
                answers: [5, 4, 7, 1, 6, 2]
            }
        };

        // Load test - no external files, uses embedded data
        function loadTest(testId) {
            console.log(`Loading test ${testId}`);
            
            currentTest = TESTS[testId];
            if (!currentTest) {
                console.error(`Test ${testId} not found`);
                document.getElementById('passage-title').textContent = 'Test Not Found';
                document.getElementById('passage-text').innerHTML = `<p style="color: var(--error-red);">Test ${testId} is not available.</p>`;
                return;
            }
            
            currentTestId = testId;
            resetTestState();
            initializeTest();
            console.log(`Test ${testId} loaded successfully`);
        }

        // Reset test state
        function resetTestState() {
            userAnswers = new Array(6).fill(null);
            usedOptions.clear();
            currentGapIndex = -1;
            closeModal();
        }

        // Initialize interface
        function initializeTest() {
            document.getElementById('passage-title').textContent = currentTest.title;
            document.getElementById('passage-text').innerHTML = currentTest.passage;
            document.getElementById('total-gaps').textContent = currentTest.answers.length;
            
            setupClickableGaps();
            updateProgress();
            resetControls();
        }

        // Setup clickable gaps
        function setupClickableGaps() {
            const gaps = document.querySelectorAll('.gap');
            
            gaps.forEach((gap, index) => {
                // Remove existing listeners
                gap.replaceWith(gap.cloneNode(true));
            });

            // Add fresh listeners
            document.querySelectorAll('.gap').forEach((gap, index) => {
                gap.addEventListener('click', () => {
                    currentGapIndex = index;
                    openGapSelector(index + 1);
                });
            });
        }

        // Open gap selection modal
        function openGapSelector(gapNumber) {
            const modal = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const optionsGrid = document.getElementById('options-grid');
            
            title.textContent = `Select option for Gap [${gapNumber}]`;
            
            // Highlight selected gap
            document.querySelectorAll('.gap').forEach(g => g.classList.remove('selected'));
            document.querySelector(`[data-gap="${gapNumber}"]`).classList.add('selected');
            
            // Populate options
            optionsGrid.innerHTML = '';
            currentTest.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = `option-btn ${usedOptions.has(index + 1) ? 'used' : ''}`;
                
                if (!usedOptions.has(index + 1) || userAnswers[currentGapIndex] === index + 1) {
                    optionBtn.addEventListener('click', () => selectOption(index + 1));
                }
                
                const letter = String.fromCharCode(65 + index);
                const optionText = option.startsWith(`${letter}.`) ? option.substring(3) : option;
                
                optionBtn.innerHTML = `
                    <span class="option-letter">${letter}</span>
                    <span class="option-text">${optionText}</span>
                `;
                
                optionsGrid.appendChild(optionBtn);
            });
            
            modal.classList.add('active');
        }

        // Select option
        function selectOption(optionIndex) {
            // Free up previously used option
            if (userAnswers[currentGapIndex] !== null) {
                usedOptions.delete(userAnswers[currentGapIndex]);
            }
            
            // Set new answer
            userAnswers[currentGapIndex] = optionIndex;
            usedOptions.add(optionIndex);
            
            // Update gap display
            const gap = document.querySelector(`[data-gap="${currentGapIndex + 1}"]`);
            const letter = String.fromCharCode(64 + optionIndex);
            gap.textContent = letter;
            gap.classList.add('filled');
            gap.classList.remove('error');
            
            closeModal();
            updateProgress();
            
            // Auto-advance to next unfilled gap
            setTimeout(autoAdvanceToNextGap, 300);
        }

        // Auto-advance to next empty gap
        function autoAdvanceToNextGap() {
            for (let i = 0; i < userAnswers.length; i++) {
                if (userAnswers[i] === null) {
                    openGapSelector(i + 1);
                    return;
                }
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('modal-overlay').classList.remove('active');
            document.querySelectorAll('.gap').forEach(g => g.classList.remove('selected'));
        }

        // Clear gap
        function clearGap() {
            if (currentGapIndex >= 0 && userAnswers[currentGapIndex] !== null) {
                usedOptions.delete(userAnswers[currentGapIndex]);
                userAnswers[currentGapIndex] = null;
                
                const gap = document.querySelector(`[data-gap="${currentGapIndex + 1}"]`);
                gap.textContent = `[${currentGapIndex + 1}]`;
                gap.classList.remove('filled', 'error');
                
                updateProgress();
            }
            closeModal();
        }

        // Update progress
        function updateProgress() {
            const completed = userAnswers.filter(answer => answer !== null).length;
            const total = userAnswers.length;
            const percentage = (completed / total) * 100;
            
            document.getElementById('completed-count').textContent = completed;
            document.getElementById('progress-fill').style.width = percentage + '%';
            
            const checkBtn = document.getElementById('check-btn');
            if (completed === total) {
                checkBtn.style.background = 'var(--success-green)';
                checkBtn.innerHTML = '<i class="fas fa-check-circle"></i> Complete!';
            } else {
                checkBtn.style.background = 'var(--secondary-teal)';
                checkBtn.innerHTML = '<i class="fas fa-check"></i> Check Answers';
            }
        }

        // Check answers
        function checkAnswers() {
            let correct = 0;
            const gaps = document.querySelectorAll('.gap');
            
            userAnswers.forEach((answer, index) => {
                const gap = gaps[index];
                gap.classList.remove('error');
                
                if (answer === currentTest.answers[index]) {
                    correct++;
                } else if (answer !== null) {
                    gap.classList.add('error');
                }
            });
            
            const score = Math.round((correct / userAnswers.length) * 100);
            
            alert(`Cambridge B2 Part 6 Result:\nScore: ${score}%\nCorrect: ${correct}/${userAnswers.length}\n\n${score >= 70 ? 'Excellent work!' : 'Keep practicing!'}`);
            
            if (score >= 70) {
                document.getElementById('next-btn').disabled = false;
                document.getElementById('next-btn').style.background = 'var(--success-green)';
            }
        }

        // Reset controls
        function resetControls() {
            const checkBtn = document.getElementById('check-btn');
            const nextBtn = document.getElementById('next-btn');
            
            checkBtn.style.background = 'var(--secondary-teal)';
            checkBtn.innerHTML = '<i class="fas fa-check"></i> Check Answers';
            nextBtn.disabled = false;
            nextBtn.style.background = 'var(--accent-gold)';
        }

        // Reset test
        function resetTest() {
            resetTestState();
            
            document.querySelectorAll('.gap').forEach((gap, index) => {
                gap.textContent = `[${index + 1}]`;
                gap.classList.remove('filled', 'error', 'selected');
            });
            
            updateProgress();
            resetControls();
            setupClickableGaps();
        }

        // Load next test
        function loadNextTest() {
            const nextId = currentTestId < 4 ? currentTestId + 1 : 1;
            document.getElementById('test-selector').value = nextId;
            loadTest(nextId);
        }

        // Event listeners
        document.getElementById('check-btn').addEventListener('click', checkAnswers);
        document.getElementById('next-btn').addEventListener('click', loadNextTest);
        document.getElementById('reset-btn').addEventListener('click', resetTest);
        document.getElementById('close-modal-btn').addEventListener('click', closeModal);
        document.getElementById('clear-gap-btn').addEventListener('click', clearGap);
        
        document.getElementById('hint-btn').addEventListener('click', () => {
            alert('Cambridge B2 Part 6 Strategy:\n\n• Click gaps to see options\n• Look for logical connections\n• Pay attention to pronouns and references\n• Consider chronological flow\n• One option will not be used');
        });

        document.getElementById('test-selector').addEventListener('change', (e) => {
            const testId = parseInt(e.target.value);
            loadTest(testId);
        });

        // Close modal when clicking overlay
        document.getElementById('modal-overlay').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                closeModal();
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Get test ID from URL or default to 1
            const urlParams = new URLSearchParams(window.location.search);
            const testId = parseInt(urlParams.get('test')) || 1;
            document.getElementById('test-selector').value = testId;
            loadTest(testId);
        });
    </script>
</body>
</html>
