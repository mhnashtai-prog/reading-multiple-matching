<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTUNITY - Reading Comprehension Part 6</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e3a5f">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-blue: #1e3a5f;
            --secondary-teal: #26a69a;
            --accent-gold: #ffd54f;
            --success-green: #66bb6a;
            --error-red: #ef5350;
            --background-dark: #0a1628;
            --text-light: #ffffff;
            --card-glass: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--background-dark) 0%, var(--primary-blue) 100%);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
        }
        
        /* Header Navigation */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--card-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
        }
        
        .brand-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: -5px;
        }
        
        .exam-info {
            font-size: 0.8rem;
            color: var(--text-light);
            opacity: 0.8;
        }
        
        .author-credit {
            position: absolute;
            top: 5px;
            right: 30px;
            font-size: 0.7rem;
            color: var(--text-light);
            opacity: 0.6;
        }
        
        .nav-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .nav-btn {
            background: var(--card-glass);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .nav-btn:hover {
            background: var(--secondary-teal);
            transform: translateY(-2px);
        }

        .test-selector {
            background: var(--accent-gold);
            color: var(--primary-blue);
            font-weight: 600;
            min-width: 180px;
            font-size: 0.8rem;
        }
        
        /* Main Container - Mobile First */
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
            gap: 20px;
        }
        
        /* Passage Area */
        .passage-container {
            background: var(--card-glass);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            border: 1px solid var(--card-border);
            padding: 20px;
            position: relative;
        }
        
        .constellation-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20px 30px, var(--accent-gold), transparent),
                radial-gradient(2px 2px at 40px 70px, var(--secondary-teal), transparent),
                radial-gradient(1px 1px at 90px 40px, var(--text-light), transparent);
            background-size: 150px 80px;
            opacity: 0.2;
            animation: twinkle 4s ease-in-out infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.2; }
            100% { opacity: 0.4; }
        }
        
        .passage-content {
            position: relative;
            z-index: 2;
        }
        
        .passage-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--accent-gold);
            text-align: center;
        }
        
        .passage-text {
            font-size: 1rem;
            line-height: 1.7;
            white-space: pre-wrap;
        }
        
        /* Interactive Gaps */
        .gap {
            display: inline-block;
            min-width: 50px;
            height: 30px;
            border: 2px solid var(--secondary-teal);
            border-radius: 8px;
            background: rgba(38, 166, 154, 0.15);
            margin: 0 3px;
            padding: 2px 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
            line-height: 26px;
        }
        
        .gap:hover {
            border-color: var(--accent-gold);
            background: rgba(255, 213, 79, 0.3);
            transform: scale(1.1);
        }
        
        .gap.selected {
            border-color: var(--accent-gold);
            background: rgba(255, 213, 79, 0.4);
            box-shadow: 0 0 15px rgba(255, 213, 79, 0.5);
        }
        
        .gap.filled {
            border-color: var(--success-green);
            background: rgba(102, 187, 106, 0.3);
            color: var(--success-green);
        }
        
        .gap.error {
            border-color: var(--error-red);
            background: rgba(239, 83, 80, 0.3);
            color: var(--error-red);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }
        
        /* Progress and Controls */
        .controls-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .progress-card {
            background: var(--card-glass);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            border: 1px solid var(--card-border);
            padding: 15px;
            text-align: center;
        }
        
        .progress-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--accent-gold);
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-teal), var(--accent-gold));
            border-radius: 3px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .progress-text {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .controls-card {
            background: var(--card-glass);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            border: 1px solid var(--card-border);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn {
            background: var(--secondary-teal);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover:not(:disabled) {
            background: var(--accent-gold);
            transform: translateY(-2px);
        }
        
        .btn.primary {
            background: var(--accent-gold);
        }
        
        .btn:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
            transform: none;
        }
        
        /* Modal Selection Interface */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--primary-blue);
            border: 2px solid var(--card-border);
            border-radius: 20px;
            padding: 25px;
            max-width: 90%;
            max-height: 85%;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .options-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            background: var(--card-glass);
            border: 2px solid var(--card-border);
            color: var(--text-light);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }
        
        .option-btn:hover {
            border-color: var(--secondary-teal);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .option-btn.used {
            opacity: 0.5;
            border-color: var(--success-green);
            cursor: not-allowed;
        }
        
        .option-letter {
            display: inline-block;
            width: 28px;
            height: 28px;
            background: var(--secondary-teal);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-weight: 600;
            margin-right: 12px;
            font-size: 0.9rem;
        }
        
        .option-btn.used .option-letter {
            background: var(--success-green);
        }
        
        .option-text {
            line-height: 1.5;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .modal-btn {
            background: var(--card-glass);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn:hover {
            background: var(--secondary-teal);
        }
        
        /* Desktop Layout */
        @media (min-width: 768px) {
            .container {
                flex-direction: row;
                padding: 20px;
            }
            
            .passage-container {
                flex: 2;
                padding: 30px;
            }
            
            .controls-section {
                flex: 1;
                grid-template-columns: 1fr;
                gap: 20px;
                margin-top: 0;
            }
            
            .modal-content {
                max-width: 600px;
            }
            
            .header {
                padding: 20px 30px;
            }
            
            .brand-title {
                font-size: 1.8rem;
            }
            
            .exam-info {
                font-size: 0.9rem;
            }
        }
        
        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="author-credit">By Majid Nashai</div>
        <div class="logo-section">
            <div class="brand-title">INTUNITY</div>
            <div class="exam-info">Reading Comprehension • Part 6</div>
        </div>
        <nav class="nav-controls">
            <a href="index.html" class="nav-btn">
                <i class="fas fa-home"></i> Home
            </a>
            <select class="nav-btn test-selector" id="test-selector">
                <option value="1">Test 1: Blind Runner</option>
                <option value="2">Test 2: Hollywood Sign</option>
                <option value="3">Test 3: Music & Running</option>
                <option value="4">Test 4: Grand Prix Driver</option>
                <option value="5">Test 5: Video Games</option>
                <option value="6">Test 6: Stand-up Comedy</option>
                <option value="7">Test 7: Guinness Records</option>
                <option value="8">Test 8: Messages in Bottles</option>
            </select>
            <button class="nav-btn" id="hint-btn">
                <i class="fas fa-lightbulb"></i>
            </button>
            <button class="nav-btn" id="reset-btn">
                <i class="fas fa-refresh"></i>
            </button>
        </nav>
    </header>

    <div class="container">
        <!-- Passage Area -->
        <div class="passage-container">
            <div class="constellation-bg"></div>
            <div class="passage-content">
                <h2 class="passage-title" id="passage-title">Loading Test...</h2>
                <div class="passage-text" id="passage-text">
                    <p>Initializing constellation interface...</p>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <!-- Progress Card -->
            <div class="progress-card">
                <h3 class="progress-title">Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p class="progress-text">
                    <span id="completed-count">0</span> of <span id="total-gaps">6</span> completed
                </p>
            </div>

            <!-- Controls -->
            <div class="controls-card">
                <button class="btn" id="check-btn">
                    <i class="fas fa-check"></i> Check Answers
                </button>
                <button class="btn primary" id="next-btn">
                    <i class="fas fa-arrow-right"></i> Next Test
                </button>
            </div>
        </div>
    </div>

    <!-- Selection Modal -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title">Select option for Gap [1]</h3>
            <div class="options-grid" id="options-grid">
                <!-- Options will be populated here -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn" id="clear-gap-btn">
                    <i class="fas fa-eraser"></i> Clear Gap
                </button>
                <button class="modal-btn" id="close-modal-btn">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTest = null;
        let currentTestId = 1;
        let userAnswers = new Array(6).fill(null);
        let usedOptions = new Set();
        let currentGapIndex = -1;

        // Sample test data for demonstration
        const sampleTest = {
            id: 1,
            title: "Breaking Barriers: The Blind Runner's Journey",
            passage: `Running marathons poses extreme challenges for anyone, but for those who are blind, the challenges are even greater. <span class='gap' data-gap='1'>[1]</span>

For Simon, now 29, he has been overcoming this disability by teaching himself to run solo on the streets. <span class='gap' data-gap='2'>[2]</span> 'I'll have right-angled cornering obstacles,' he explains.

Then he got bored and wanted to try running solo again. Weeks of gradual exploration followed, walking a route over and over. <span class='gap' data-gap='3'>[3]</span> This information could then be transferred to a smartphone.

Now Simon knows precisely every step on the roads. <span class='gap' data-gap='4'>[4]</span> When I first started, I had to run very cautiously to prevent falls.

<span class='gap' data-gap='5'>[5]</span> Now it has evolved steadily, and Simon can run distances up to thirty miles. For Simon, the real thrill comes from being able to compete successfully in races. <span class='gap' data-gap='6'>[6]</span>`,
            options: [
                "A. These provide the familiarity and consistency essential for the blind runner.",
                "B. Their support gave him extra confidence regarding his changing surroundings.",
                "C. Simon believes the feelings of liberation outweigh any anxiety over such dangers.",
                "D. He began by training on football pitches behind his house, running between goalposts.",
                "E. It gives him a great opportunity to run with everyone.",
                "F. That's not to say the learning curve has been without incident.",
                "G. As a result, he was able to memorise a set five-kilometre course."
            ],
            answers: [3, 1, 7, 6, 2, 4] // Randomized answers
        };

        // Initialize interface
        function initializeTest() {
            currentTest = sampleTest; // Using sample for demo
            
            document.getElementById('passage-title').textContent = currentTest.title;
            document.getElementById('passage-text').innerHTML = currentTest.passage;
            document.getElementById('total-gaps').textContent = currentTest.answers.length;
            
            setupClickableGaps();
            updateProgress();
        }

        // Setup clickable gaps
        function setupClickableGaps() {
            const gaps = document.querySelectorAll('.gap');
            
            gaps.forEach((gap, index) => {
                gap.addEventListener('click', () => {
                    currentGapIndex = index;
                    openGapSelector(index + 1);
                });
            });
        }

        // Open gap selection modal
        function openGapSelector(gapNumber) {
            const modal = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const optionsGrid = document.getElementById('options-grid');
            
            title.textContent = `Select option for Gap [${gapNumber}]`;
            
            // Highlight selected gap
            document.querySelectorAll('.gap').forEach(g => g.classList.remove('selected'));
            document.querySelector(`[data-gap="${gapNumber}"]`).classList.add('selected');
            
            // Populate options
            optionsGrid.innerHTML = '';
            currentTest.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = `option-btn ${usedOptions.has(index + 1) ? 'used' : ''}`;
                
                if (!usedOptions.has(index + 1) || userAnswers[currentGapIndex] === index + 1) {
                    optionBtn.addEventListener('click', () => selectOption(index + 1));
                }
                
                const letter = String.fromCharCode(65 + index);
                const optionText = option.startsWith(`${letter}.`) ? option.substring(3) : option;
                
                optionBtn.innerHTML = `
                    <span class="option-letter">${letter}</span>
                    <span class="option-text">${optionText}</span>
                `;
                
                optionsGrid.appendChild(optionBtn);
            });
            
            modal.classList.add('active');
        }

        // Select option
        function selectOption(optionIndex) {
            // Free up previously used option
            if (userAnswers[currentGapIndex] !== null) {
                usedOptions.delete(userAnswers[currentGapIndex]);
            }
            
            // Set new answer
            userAnswers[currentGapIndex] = optionIndex;
            usedOptions.add(optionIndex);
            
            // Update gap display
            const gap = document.querySelector(`[data-gap="${currentGapIndex + 1}"]`);
            const letter = String.fromCharCode(64 + optionIndex);
            gap.textContent = letter;
            gap.classList.add('filled');
            gap.classList.remove('error');
            
            closeModal();
            updateProgress();
            
            // Auto-advance to next unfilled gap
            autoAdvanceToNextGap();
        }

        // Auto-advance to next empty gap
        function autoAdvanceToNextGap() {
            for (let i = 0; i < userAnswers.length; i++) {
                if (userAnswers[i] === null) {
                    setTimeout(() => {
                        openGapSelector(i + 1);
                    }, 300);
                    return;
                }
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('modal-overlay').classList.remove('active');
            document.querySelectorAll('.gap').forEach(g => g.classList.remove('selected'));
        }

        // Clear gap
        function clearGap() {
            if (currentGapIndex >= 0 && userAnswers[currentGapIndex] !== null) {
                usedOptions.delete(userAnswers[currentGapIndex]);
                userAnswers[currentGapIndex] = null;
                
                const gap = document.querySelector(`[data-gap="${currentGapIndex + 1}"]`);
                gap.textContent = `[${currentGapIndex + 1}]`;
                gap.classList.remove('filled', 'error');
                
                updateProgress();
            }
            closeModal();
        }

        // Update progress
        function updateProgress() {
            const completed = userAnswers.filter(answer => answer !== null).length;
            const total = userAnswers.length;
            const percentage = (completed / total) * 100;
            
            document.getElementById('completed-count').textContent = completed;
            document.getElementById('progress-fill').style.width = percentage + '%';
            
            const checkBtn = document.getElementById('check-btn');
            if (completed === total) {
                checkBtn.style.background = 'var(--success-green)';
                checkBtn.innerHTML = '<i class="fas fa-check-circle"></i> Complete!';
            } else {
                checkBtn.style.background = 'var(--secondary-teal)';
                checkBtn.innerHTML = '<i class="fas fa-check"></i> Check Answers';
            }
        }

        // Check answers
        function checkAnswers() {
            let correct = 0;
            const gaps = document.querySelectorAll('.gap');
            
            userAnswers.forEach((answer, index) => {
                const gap = gaps[index];
                gap.classList.remove('error');
                
                if (answer === currentTest.answers[index]) {
                    correct++;
                } else if (answer !== null) {
                    gap.classList.add('error');
                }
            });
            
            const score = Math.round((correct / userAnswers.length) * 100);
            
            alert(`Cambridge B2 Part 6 Result:\nScore: ${score}%\nCorrect: ${correct}/${userAnswers.length}\n\n${score >= 70 ? 'Excellent work!' : 'Keep practicing!'}`);
            
            if (score >= 70) {
                document.getElementById('next-btn').disabled = false;
                document.getElementById('next-btn').style.background = 'var(--success-green)';
            }
        }

        // Reset test
        function resetTest() {
            userAnswers = new Array(6).fill(null);
            usedOptions.clear();
            
            document.querySelectorAll('.gap').forEach((gap, index) => {
                gap.textContent = `[${index + 1}]`;
                gap.classList.remove('filled', 'error', 'selected');
            });
            
            updateProgress();
            document.getElementById('next-btn').disabled = false;
        }

        // Load next test
        function loadNextTest() {
            const nextId = currentTestId < 8 ? currentTestId + 1 : 1;
            currentTestId = nextId;
            document.getElementById('test-selector').value = nextId;
            
            // For demo, just reset current test
            resetTest();
            alert(`Loading Test ${nextId}...`);
        }

        // Event listeners
        document.getElementById('check-btn').addEventListener('click', checkAnswers);
        document.getElementById('next-btn').addEventListener('click', loadNextTest);
        document.getElementById('reset-btn').addEventListener('click', resetTest);
        document.getElementById('close-modal-btn').addEventListener('click', closeModal);
        document.getElementById('clear-gap-btn').addEventListener('click', clearGap);
        
        document.getElementById('hint-btn').addEventListener('click', () => {
            alert('Cambridge B2 Part 6 Strategy:\n\n• Click gaps to see options\n• Look for logical connections\n• Pay attention to pronouns and references\n• Consider chronological flow\n• One option will not be used');
        });

        document.getElementById('test-selector').addEventListener('change', (e) => {
            const testId = parseInt(e.target.value);
            currentTestId = testId;
            resetTest();
            alert(`Loading Test ${testId}...`);
        });

        // Close modal when clicking overlay
        document.getElementById('modal-overlay').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                closeModal();
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeTest);
    </script>
</body>
</html>
